<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PotholeVision ‚Äî Giao di·ªán h·ªá th·ªëng ph√°t hi·ªán ·ªï g√†</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Leaflet (b·∫£n ƒë·ªì) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <!-- Chart.js (th·ªëng k√™) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root{
      --primary-bg: #eaf6ff; /* xanh da tr·ªùi nh·∫°t l√†m n·ªÅn */
      --primary: #8ed0ff;   /* nh·∫°t h∆°n cho nh·∫•n nh√° */
      --primary-strong:#3ba4f6; /* xanh nh·∫•n */
      --ink: #0f172a;
      --muted: #475569;
      --surface: #ffffff;
      --border: #dbeafe;
      --good: #16a34a;
      --warn: #f59e0b;
      --bad:  #ef4444;
      --shadow: 0 10px 30px rgba(59,164,246,0.15);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink); background:linear-gradient(180deg,var(--primary-bg),#f8fbff 60%);
    }
    .app{display:grid; grid-template-columns:280px 1fr; min-height:100vh}
    /* Sidebar */
    .sidebar{position:sticky; top:0; height:100vh; padding:20px; border-right:1px solid var(--border); background:rgba(255,255,255,0.7); backdrop-filter:saturate(180%) blur(8px)}
    .brand{display:flex; align-items:center; gap:12px; margin-bottom:18px}
    .logo{width:40px; height:40px; border-radius:12px; background:linear-gradient(135deg,var(--primary),var(--primary-strong)); box-shadow:var(--shadow); position:relative}
    .logo::after{content:""; position:absolute; inset:8px; border-radius:10px; background:rgba(255,255,255,0.6)}
    .brand h1{font-size:18px; margin:0}
    .tagline{font-size:12px; color:var(--muted)}
    .nav{margin-top:14px; display:flex; flex-direction:column; gap:6px}
    .nav a{display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; color:#0a2540; text-decoration:none; font-weight:500}
    .nav a:hover{background:#f0f8ff}
    .nav a.active{background:linear-gradient(135deg,#e6f4ff,#f3faff); border:1px solid var(--border)}
    .kbd{margin-top:auto; font-size:12px; color:var(--muted)}

    /* Header */
    .header{display:flex; align-items:center; justify-content:space-between; padding:18px 24px; position:sticky; top:0; background:rgba(255,255,255,0.6); border-bottom:1px solid var(--border); backdrop-filter:saturate(180%) blur(8px); z-index:5}
    .search{display:flex; align-items:center; gap:10px; background:#fff; padding:10px 12px; border-radius:12px; border:1px solid var(--border); min-width:360px}
    .search input{border:none; outline:none; font:inherit; width:100%}
    .header-actions{display:flex; align-items:center; gap:10px}
    .btn{border:1px solid var(--border); background:#fff; padding:10px 14px; border-radius:12px; font-weight:600; cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,#dff3ff,#cfeaff); border-color:#cfeaff}
    .btn.ghost{background:transparent}

    /* Main */
    .main{padding:20px 24px 64px}
    .grid{display:grid; gap:16px}
    .grid.cols-4{grid-template-columns:repeat(4,1fr)}
    .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    .grid.cols-2{grid-template-columns:repeat(2,1fr)}
    .card{background:var(--surface); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow)}
    .card .hd{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px dashed var(--border)}
    .card .hd h3{margin:0; font-size:15px}
    .card .bd{padding:16px}

    .kpi{display:flex; align-items:center; gap:12px}
    .kpi .num{font-size:28px; font-weight:800}
    .kpi .trend{font-size:12px}

    .upload-zone{border:2px dashed #b6e0ff; border-radius:14px; padding:18px; text-align:center; background:#f6fbff}
    .upload-zone.drag{background:#e9f6ff}
    .upload-zone input{display:none}

    .video-wrap{position:relative; background:linear-gradient(180deg,#f4fbff,#ffffff); border-radius:12px; border:1px solid var(--border); overflow:hidden}
    .video{display:block; width:100%; background:#000; aspect-ratio:16/9}
    .overlay{position:absolute; inset:0; pointer-events:none}

    .control-row{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
    .control-row .form{display:flex; gap:10px; align-items:center}
    .control-row label{font-size:13px; color:var(--muted)}
    .control-row input[type="range"]{width:180px}
    .badge{display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border); background:#f7fbff}

    #map{height:340px; border-radius:12px; border:1px solid var(--border)}

    table{width:100%; border-collapse:collapse}
    th,td{padding:10px 8px; border-bottom:1px solid #eef6ff; font-size:14px}
    th{text-align:left; color:var(--muted); font-weight:600}
    tr:hover td{background:#f8fcff}
    .sev{padding:4px 8px; border-radius:8px; font-weight:700; font-size:12px}
    .sev.lo{background:#ecfdf5}
    .sev.md{background:#fff7ed}
    .sev.hi{background:#fef2f2}

    .footer{margin-top:20px; text-align:center; color:var(--muted); font-size:12px}

    /* Responsive */
    @media (max-width:1200px){
      .app{grid-template-columns:220px 1fr}
      .grid.cols-4{grid-template-columns:repeat(2,1fr)}
      .grid.cols-3{grid-template-columns:repeat(2,1fr)}
    }
    @media (max-width:860px){
      .app{grid-template-columns:1fr}
      .sidebar{position:relative; height:auto}
      .search{min-width:0; width:100%}
      .grid.cols-2, .grid.cols-3, .grid.cols-4{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
<div class="app">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>PotholeVision</h1>
        <div class="tagline">Smart Road Defect Detection</div>
      </div>
    </div>
    <nav class="nav" aria-label="ƒêi·ªÅu h∆∞·ªõng">
      <a href="#dashboard" class="active">üìä T·ªïng quan</a>
      <a href="#detect">üé• Ph√°t hi·ªán tr·ª±c ti·∫øp</a>
      <a href="#mapview">üó∫Ô∏è B·∫£n ƒë·ªì & C·∫£nh b√°o</a>
      <a href="#reports">üìÑ B√°o c√°o & Nh·∫≠t k√Ω</a>
      <a href="#settings">‚öôÔ∏è C·∫•u h√¨nh m√¥ h√¨nh</a>
      <a href="#about">‚ùì Tr·ª£ gi√∫p</a>
    </nav>
    <div class="kbd">M·∫πo: nh·∫•n <b>/</b> ƒë·ªÉ t√¨m ki·∫øm nhanh</div>
  </aside>

  <!-- Content -->
  <div>
    <header class="header">
      <div class="search" role="search">
        üîé <input id="q" placeholder="T√¨m ki·∫øm camera, tuy·∫øn ƒë∆∞·ªùng, ID ph√°t hi·ªán‚Ä¶"/>
      </div>
      <div class="header-actions">
        <button class="btn ghost" id="btnDark">üåó</button>
        <button class="btn primary">‚ûï T·∫°o b√°o c√°o</button>
      </div>
    </header>

    <main class="main">
      <!-- Dashboard KPIs -->
      <section id="dashboard" class="grid cols-4">
        <div class="card">
          <div class="hd"><h3>T·ªïng s·ªë ph√°t hi·ªán (30 ng√†y)</h3><span class="badge">Realtime</span></div>
          <div class="bd kpi"><div class="num" id="kpiDetections">1,284</div><div class="trend" id="kpiTrend">‚ñ≤ 12% so v·ªõi k·ª≥ tr∆∞·ªõc</div></div>
        </div>
        <div class="card">
          <div class="hd"><h3>Camera ƒëang ho·∫°t ƒë·ªông</h3><span class="badge">Edge + Cloud</span></div>
          <div class="bd kpi"><div class="num">42</div><div class="trend">8 tuy·∫øn ƒë∆∞·ªùng ∆∞u ti√™n</div></div>
        </div>
        <div class="card">
          <div class="hd"><h3>ƒê·ªô tin c·∫≠y trung b√¨nh</h3><span class="badge">mAP@0.5</span></div>
          <div class="bd kpi"><div class="num" id="kpiConf">0.86</div><div class="trend">m√¥ h√¨nh v2.3 (YOLOv8)</div></div>
        </div>
        <div class="card">
          <div class="hd"><h3>Th·ªùi gian x·ª≠ l√Ω khung h√¨nh</h3><span class="badge">Edge T4</span></div>
          <div class="bd kpi"><div class="num" id="kpiLatency">38 ms</div><div class="trend">~26 FPS</div></div>
        </div>
      </section>

      <!-- Chart + Upload -->
      <section class="grid cols-3" style="margin-top:16px">
        <div class="card" style="grid-column:span 2">
          <div class="hd"><h3>Th·ªëng k√™ theo ng√†y</h3><span class="badge">Pothole counts</span></div>
          <div class="bd"><canvas id="chartDetections" height="120"></canvas></div>
        </div>
        <div class="card">
          <div class="hd"><h3>T·∫£i ·∫£nh/video ƒë·ªÉ ph√¢n t√≠ch</h3><span class="badge">Batch</span></div>
          <div class="bd">
            <label class="upload-zone" id="drop">
              <input id="file" type="file" accept="image/*,video/*" multiple />
              <div><b>K√©o & th·∫£</b> ho·∫∑c nh·∫•n ƒë·ªÉ ch·ªçn t·ªáp ·∫£nh/video</div>
              <div class="tagline">H·ªó tr·ª£: JPG/PNG/MP4/MOV (‚â§ 200MB/m·ªói t·ªáp)</div>
            </label>
            <div id="queue" style="margin-top:12px; font-size:14px; color:var(--muted)">Ch∆∞a c√≥ t·ªáp n√†o‚Ä¶</div>
            <div style="margin-top:12px; display:flex; gap:8px">
              <button class="btn" id="btnProcess">‚ñ∂Ô∏è Ph√¢n t√≠ch</button>
              <button class="btn" id="btnClear">üßπ Xo√° danh s√°ch</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Live Detection Demo -->
      <section id="detect" class="grid cols-2" style="margin-top:16px">
        <div class="card" style="grid-column:span 1">
          <div class="hd"><h3>Demo ph√°t hi·ªán tr·ª±c ti·∫øp</h3><span class="badge">Overlay</span></div>
          <div class="bd">
            <div class="video-wrap">
              <video id="video" class="video" muted playsinline></video>
              <canvas id="overlay" class="overlay"></canvas>
            </div>
            <div class="control-row" style="margin-top:12px">
              <button class="btn" id="btnSample">üé¨ Ch·∫°y tr√™n video m·∫´u</button>
              <button class="btn" id="btnPause">‚è∏Ô∏è T·∫°m d·ª´ng</button>
              <button class="btn" id="btnResume">‚ñ∂Ô∏è Ti·∫øp t·ª•c</button>
              <div class="form">
                <label>Ng∆∞·ª°ng tin c·∫≠y</label>
                <input id="thr" type="range" min="0.2" max="0.95" step="0.01" value="0.5"/>
                <span class="badge" id="thrVal">0.50</span>
              </div>
              <div class="form">
                <label>NMS IoU</label>
                <input id="nms" type="range" min="0.2" max="0.9" step="0.01" value="0.45"/>
                <span class="badge" id="nmsVal">0.45</span>
              </div>
            </div>
          </div>
        </div>
        <div class="card" style="grid-column:span 1">
          <div class="hd"><h3>Th√¥ng s·ªë m√¥ h√¨nh</h3><span class="badge">Model v2.3</span></div>
          <div class="bd">
            <div class="grid cols-2">
              <div>
                <div><b>Backbone:</b> YOLOv8n</div>
                <div><b>Input:</b> 640√ó640</div>
                <div><b>mAP@0.5:</b> 0.89</div>
                <div><b>FPS (Edge):</b> 25‚Äì35</div>
              </div>
              <div>
                <div><b>Classes:</b> {pothole}</div>
                <div><b>Aug:</b> HSV, mosaic, flip</div>
                <div><b>Quantize:</b> INT8 (t√πy ch·ªçn)</div>
                <div><b>Deploy:</b> ONNX/TensorRT</div>
              </div>
            </div>
            <div style="margin-top:12px">
              <label>Phi√™n b·∫£n m√¥ h√¨nh</label>
              <select id="modelSel" class="btn" style="width:100%">
                <option>v2.3 (stable)</option>
                <option>v2.4 (beta ‚Äì c·∫£i thi·ªán recall)</option>
                <option>v1.9 (LTS)</option>
              </select>
            </div>
            <div style="margin-top:12px; display:flex; gap:8px">
              <button class="btn primary">üíæ L∆∞u c·∫•u h√¨nh</button>
              <button class="btn">‚Ü©Ô∏è Kh√¥i ph·ª•c m·∫∑c ƒë·ªãnh</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Map & Alerts -->
      <section id="mapview" class="grid cols-2" style="margin-top:16px">
        <div class="card" style="grid-column:span 1">
          <div class="hd"><h3>B·∫£n ƒë·ªì ·ªï g√† & c·ª•m nguy c∆°</h3><span class="badge">Geo clustering</span></div>
          <div class="bd"><div id="map" aria-label="B·∫£n ƒë·ªì t√¨nh tr·∫°ng m·∫∑t ƒë∆∞·ªùng"></div></div>
        </div>
        <div class="card" style="grid-column:span 1">
          <div class="hd"><h3>C·∫£nh b√°o g·∫ßn ƒë√¢y</h3><span class="badge">Webhook + Email</span></div>
          <div class="bd">
            <ul id="alerts" style="list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:8px"></ul>
            <div style="margin-top:12px; display:flex; gap:8px">
              <button class="btn">üîî C·∫•u h√¨nh c·∫£nh b√°o</button>
              <button class="btn">üì§ Xu·∫•t GeoJSON</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Logs / Reports -->
      <section id="reports" class="card" style="margin-top:16px">
        <div class="hd"><h3>Nh·∫≠t k√Ω ph√°t hi·ªán</h3><span class="badge">Audit & Export</span></div>
        <div class="bd">
          <div style="display:flex; gap:8px; margin-bottom:8px; flex-wrap:wrap">
            <input class="btn" style="flex:1" id="filterText" placeholder="L·ªçc theo ID/ƒë∆∞·ªùng/ngu·ªìn‚Ä¶" />
            <select class="btn" id="filterSeverity">
              <option value="">T·∫•t c·∫£ m·ª©c ƒë·ªô</option>
              <option value="Low">Low</option>
              <option value="Medium">Medium</option>
              <option value="High">High</option>
            </select>
            <button class="btn">‚¨áÔ∏è T·∫£i CSV</button>
            <button class="btn">üñ®Ô∏è In b√°o c√°o</button>
          </div>
          <div style="overflow:auto">
            <table id="tbl">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Th·ªùi gian</th>
                  <th>M·ª©c ƒë·ªô</th>
                  <th>V·ªã tr√≠</th>
                  <th>Ngu·ªìn</th>
                  <th>ƒê·ªô tin c·∫≠y</th>
                  <th>Thao t√°c</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Settings / About -->
      <section id="settings" class="grid cols-2" style="margin-top:16px">
        <div class="card">
          <div class="hd"><h3>C√†i ƒë·∫∑t h·ªá th·ªëng</h3><span class="badge">Admin</span></div>
          <div class="bd">
            <label class="form" style="display:flex; flex-direction:column; gap:6px; margin-bottom:10px">
              <span>Ch·∫ø ƒë·ªô tri·ªÉn khai</span>
              <select class="btn" id="deployMode">
                <option>Edge (camera)</option>
                <option>Cloud (batch)</option>
                <option>Hybrid</option>
              </select>
            </label>
            <label class="form" style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px">
              <span>G·ª≠i d·ªØ li·ªáu ·∫©n danh ƒë·ªÉ c·∫£i thi·ªán m√¥ h√¨nh</span>
              <input type="checkbox" id="telemetry" checked/>
            </label>
            <label class="form" style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px">
              <span>C·∫£nh b√°o v∆∞·ª£t ng∆∞·ª°ng 5 ·ªï g√†/km</span>
              <input type="checkbox" id="hotspot" checked/>
            </label>
          </div>
        </div>
        <div id="about" class="card">
          <div class="hd"><h3>Gi·ªõi thi·ªáu</h3><span class="badge">T√†i li·ªáu</span></div>
          <div class="bd">
            <p><b>PotholeVision</b> l√† giao di·ªán tham kh·∫£o cho h·ªá th·ªëng ph√°t hi·ªán ·ªï g√† hi·ªán ƒë·∫°i: h·ªó tr·ª£ ph√°t tr·ª±c ti·∫øp t·ª´ camera h√†nh tr√¨nh/camera giao th√¥ng, b·∫£n ƒë·ªì c·ª•m nguy c∆°, c·∫•u h√¨nh m√¥ h√¨nh (ng∆∞·ª°ng, NMS), x·ª≠ l√Ω batch ·∫£nh/video, qu·∫£n tr·ªã c·∫£nh b√°o v√† xu·∫•t b√°o c√°o.</p>
            <p>Thi·∫øt k·∫ø ∆∞u ti√™n: giao di·ªán r√µ r√†ng, m√†u xanh da tr·ªùi nh·∫°t l√†m ch·ªß ƒë·∫°o, d·ªÖ tri·ªÉn khai th·ª±c t·∫ø tr√™n Edge/Cloud, c√≥ th·ªÉ t√≠ch h·ª£p API inference (REST/gRPC) v√† ngu·ªìn d·ªØ li·ªáu GIS.</p>
          </div>
        </div>
      </section>

      <div class="footer">¬© 2025 PotholeVision UI ‚Äî b·∫£n demo giao di·ªán, ch∆∞a t√≠ch h·ª£p m√¥ h√¨nh th·ª±c.</div>
    </main>
  </div>
</div>

<script>
  // Dark mode (t·ªëi gi·∫£n cho demo)
  const btnDark = document.getElementById('btnDark');
  let dark=false; btnDark.addEventListener('click',()=>{
    dark=!dark; document.documentElement.style.filter = dark? 'invert(0.93) hue-rotate(180deg)' : '';
  });
  // Quick search focus
  window.addEventListener('keydown', e=>{ if(e.key==='/' && document.activeElement.tagName!=='INPUT'){ e.preventDefault(); document.getElementById('q').focus(); }});

  // KPIs fake update
  setInterval(()=>{
    const conf = (0.84 + Math.random()*0.04).toFixed(2);
    const lat = Math.floor(34+Math.random()*8);
    document.getElementById('kpiConf').textContent = conf;
    document.getElementById('kpiLatency').textContent = lat+' ms';
  }, 4000);

  // Chart.js demo data
  const ctx = document.getElementById('chartDetections');
  const today = new Date();
  const labels = Array.from({length:14}, (_,i)=>{
    const d = new Date(today); d.setDate(d.getDate()-13+i);
    return d.toLocaleDateString('vi-VN',{day:'2-digit',month:'2-digit'});
  });
  const data = labels.map(()=> Math.floor(40+Math.random()*60));
  new Chart(ctx, { type:'line', data:{ labels, datasets:[{ label:'S·ªë ·ªï g√†/ng√†y', data, tension:0.35 }]}, options:{ responsive:true, plugins:{ legend:{ display:false }}}});

  // Upload drop-zone
  const drop = document.getElementById('drop');
  const file = document.getElementById('file');
  const queue = document.getElementById('queue');
  const selFiles = [];
  drop.addEventListener('dragover', e=>{ e.preventDefault(); drop.classList.add('drag'); });
  drop.addEventListener('dragleave', ()=> drop.classList.remove('drag'));
  drop.addEventListener('drop', e=>{ e.preventDefault(); drop.classList.remove('drag'); handleFiles(e.dataTransfer.files); });
  drop.addEventListener('click', ()=> file.click());
  file.addEventListener('change', e=> handleFiles(e.target.files));
  function handleFiles(files){
    for(const f of files){ selFiles.push(f); }
    if(selFiles.length){ queue.innerHTML = selFiles.map((f,i)=>`#${i+1} ${f.name} <span class='badge'>${(f.size/1e6).toFixed(1)} MB</span>`).join('<br>'); }
    else{ queue.textContent='Ch∆∞a c√≥ t·ªáp n√†o‚Ä¶'; }
  }
  document.getElementById('btnClear').onclick=()=>{ selFiles.length=0; queue.textContent='ƒê√£ xo√° danh s√°ch.' };
  document.getElementById('btnProcess').onclick=()=>{ if(!selFiles.length){ alert('H√£y th√™m √≠t nh·∫•t 1 t·ªáp.'); return; } alert('Demo: gi·∫£ l·∫≠p g·ª≠i l√™n API inference ƒë·ªÉ x·ª≠ l√Ω batch.'); };

  // Live detection overlay (gi·∫£ l·∫≠p h·ªôp bounding)
  const video = document.getElementById('video');
  const overlay = document.getElementById('overlay');
  const ctx2 = overlay.getContext('2d');
  const btnSample = document.getElementById('btnSample');
  const btnPause = document.getElementById('btnPause');
  const btnResume = document.getElementById('btnResume');
  const thr = document.getElementById('thr');
  const nms = document.getElementById('nms');
  const thrVal = document.getElementById('thrVal');
  const nmsVal = document.getElementById('nmsVal');

  thr.oninput=()=> thrVal.textContent = (+thr.value).toFixed(2);
  nms.oninput=()=> nmsVal.textContent = (+nms.value).toFixed(2);

  // S·ª≠ d·ª•ng MediaSource: ƒë·ªÉ simple demo, ta ph√°t l·∫°i 1 video public n·∫øu c√≥ m·∫°ng, n·∫øu kh√¥ng ch·ªâ hi·ªÉn th·ªã n·ªÅn ƒëen.
  const sampleSrc = 'https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4';
  btnSample.onclick= async()=>{
    try{
      video.src = sampleSrc; await video.play(); animate();
    }catch(e){ console.warn(e); }
  };
  btnPause.onclick=()=> video.pause();
  btnResume.onclick=()=> video.play();

  function animate(){
    if(video.paused || video.ended) return; // d·ª´ng v·∫Ω khi t·∫°m d·ª´ng
    resizeCanvasToVideo();
    ctx2.clearRect(0,0,overlay.width,overlay.height);
    // v·∫Ω v√†i box ng·∫´u nhi√™n ƒë·ªÉ m√¥ ph·ªèng detection
    const boxes = Array.from({length: Math.floor(2+Math.random()*3)}, ()=>({
      x: Math.random()*overlay.width*0.8,
      y: Math.random()*overlay.height*0.8,
      w: 60+Math.random()*120,
      h: 40+Math.random()*80,
      c: (0.5+Math.random()*0.5)
    })).filter(b=> b.c >= parseFloat(thr.value));
    for(const b of boxes){
      ctx2.strokeStyle = 'rgba(59,164,246,0.9)';
      ctx2.lineWidth = 3; ctx2.strokeRect(b.x,b.y,b.w,b.h);
      drawLabel(ctx2, `pothole ${(b.c).toFixed(2)}`, b.x, b.y);
    }
    requestAnimationFrame(animate);
  }
  function drawLabel(ctx, text, x, y){
    ctx.font = '14px Inter';
    const padding = 6;
    const metrics = ctx.measureText(text);
    const w = metrics.width + padding*2;
    const h = 22;
    ctx.fillStyle = 'rgba(234,246,255,0.9)';
    ctx.fillRect(x, y-h, w, h);
    ctx.strokeStyle = 'rgba(179,224,255,1)';
    ctx.strokeRect(x, y-h, w, h);
    ctx.fillStyle = '#0a2540';
    ctx.fillText(text, x+padding, y-6);
  }
  function resizeCanvasToVideo(){
    const rect = video.getBoundingClientRect();
    overlay.width = rect.width * devicePixelRatio;
    overlay.height = rect.height * devicePixelRatio;
    overlay.style.width = rect.width+'px';
    overlay.style.height = rect.height+'px';
    ctx2.scale(devicePixelRatio, devicePixelRatio);
  }
  window.addEventListener('resize', resizeCanvasToVideo);

  // Leaflet map demo
  const map = L.map('map').setView([21.0285, 105.8542], 12); // H√† N·ªôi
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19, attribution:'¬© OpenStreetMap'}).addTo(map);
  const clusterData = [
    { name:'QL32 ‚Äì C·∫ßu Di·ªÖn', coords:[21.039,105.748], count:12, severity:'High' },
    { name:'Gi·∫£i Ph√≥ng ‚Äì Linh ƒê√†m', coords:[20.971,105.832], count:7, severity:'Medium' },
    { name:'Ph·∫°m H√πng', coords:[21.017,105.780], count:3, severity:'Low' },
  ];
  clusterData.forEach(pt=>{
    const color = pt.severity==='High'? '#ef4444' : pt.severity==='Medium'? '#f59e0b' : '#16a34a';
    const circle = L.circleMarker(pt.coords, { radius: 10+pt.count/2, color, weight:2, fillOpacity:0.25 });
    circle.addTo(map).bindPopup(`<b>${pt.name}</b><br/>S·ªë ·ªï g√†: ${pt.count}<br/>M·ª©c ƒë·ªô: ${pt.severity}`);
  });

  // Alerts list
  const alerts = document.getElementById('alerts');
  const alertItems=[
    { t:'10:21', msg:'C·ª•m nguy c∆° cao t·∫°i QL32 ‚Äì C·∫ßu Di·ªÖn (12 ·ªï g√†/km)' },
    { t:'09:58', msg:'Camera BUS_07 m·∫•t k·∫øt n·ªëi 2 ph√∫t' },
    { t:'08:40', msg:'3 ph√°t hi·ªán m·ª©c High t·∫°i Gi·∫£i Ph√≥ng ‚Äì Linh ƒê√†m' },
  ];
  alerts.innerHTML = alertItems.map(a=>`<li class='badge' style='display:flex; justify-content:space-between'><span>‚è±Ô∏è ${a.t}</span><span>${a.msg}</span></li>`).join('');

  // Logs table (demo data + filter)
  const rows = Array.from({length:48}, (_,i)=>{
    const sev = ['Low','Medium','High'][Math.floor(Math.random()*3)];
    const c = (0.5+Math.random()*0.5).toFixed(2);
    const time = new Date(Date.now()-i*3600*1000).toLocaleString('vi-VN');
    const road = ['QL32','Ph·∫°m H√πng','Gi·∫£i Ph√≥ng','Tr∆∞·ªùng Chinh','V√†nh ƒëai 3'][Math.floor(Math.random()*5)];
    const src = ['CAM_12','DASH_05','DRONE_02'][Math.floor(Math.random()*3)];
    return { id: 'PH'+String(1000+i), time, sev, loc: road, src, conf:c };
  });
  const tbody = document.querySelector('#tbl tbody');
  function renderTable(){
    const q = document.getElementById('filterText').value.toLowerCase();
    const sevFilter = document.getElementById('filterSeverity').value;
    tbody.innerHTML = rows.filter(r=>
      (!q || JSON.stringify(r).toLowerCase().includes(q)) &&
      (!sevFilter || r.sev===sevFilter)
    ).map(r=>`<tr>
      <td>${r.id}</td>
      <td>${r.time}</td>
      <td><span class='sev ${r.sev==='High'?'hi':r.sev==='Medium'?'md':'lo'}'>${r.sev}</span></td>
      <td>${r.loc}</td>
      <td>${r.src}</td>
      <td>${r.conf}</td>
      <td><button class='btn'>üìç Xem tr√™n b·∫£n ƒë·ªì</button></td>
    </tr>`).join('');
  }
  renderTable();
  document.getElementById('filterText').addEventListener('input', renderTable);
  document.getElementById('filterSeverity').addEventListener('change', renderTable);
</script>
</body>
</html>
