<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Bản đồ ổ gà</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      :root {
        --primary: #74bbeeff;
        --accent-pink: #fd91fdff;
        --accent-green: #7eea82ff;
        --bg-light: #eef6ff;
        --text-dark: #333;
        --text-light: #fff;
      }
      
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: var(--bg-light);
        color: var(--text-dark);
        display: flex;
        height: 100vh;
        overflow: hidden;
      }
      
      .map-container {
        flex: 1;
        height: 80vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #map {
        width: 100%;
        height: 100%;
      }
      
      .legend {
        background: white;
        padding: 10px;
        border-radius: 8px;
        line-height: 1.5;
        font-size: 14px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      }
      
      .legend span {
        display: inline-block;
        width: 12px;
        height: 12px;
        margin-right: 6px;
        border-radius: 50%;
      }
      
      .dot-small {
        background: green;
      }
      
      .dot-large {
        background: red;
      }
    </style>
  </head>
  <body data-theme="light">
    <!-- Sidebar -->
    <aside class="sidebar">
      {% include 'my_app/sidebar.html' %}
    </aside>

    <!-- Map -->
    <div class="map-container">
      <div id="map"></div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <script>
    var map = L.map('map').setView([10.762622, 106.660172], 13); // vị trí mặc định (TP.HCM)

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    {% for pothole in potholes %}
        var marker = L.circleMarker([{{ pothole.latitude }}, {{ pothole.longitude }}], {
            color: {% if pothole.id == highlighted.id %} 'blue' {% elif pothole.detections_count > 3 %} 'red' {% else %} 'green' {% endif %},
            radius: {% if pothole.id == highlighted.id %} 10 {% elif pothole.confidence_avg > 0.7 %} 8 {% else %} 5 {% endif %}
        }).addTo(map);

        marker.bindPopup("Ổ gà ID: {{ pothole.id }}<br>Phát hiện: {{ pothole.detections_count }} lần <br> Độ tin cậy TB: {{ pothole.confidence_avg|floatformat:2 }}%");
    {% endfor %}

    {% if highlighted %}
        map.setView([{{ highlighted.latitude }}, {{ highlighted.longitude }}], 16);
    {% endif %}
</script>
  </body>
</html>
