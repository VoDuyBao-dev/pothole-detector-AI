{% load static %}
<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Bản đồ ổ gà</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="{% static 'my_app/css/map.css' %}" />
    <link rel="stylesheet" href="{% static 'my_app/css/sidebar.css' %}" />
  </head>
  <body data-theme="light">
    <!-- Sidebar -->
    <aside class="sidebar">
      {% include 'my_app/menu.html' %}
    </aside>

    <!-- Map -->
    <div class="map-container">
      <div id="map"></div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <script>
    var map = L.map('map').setView([10.762622, 106.660172], 13); // vị trí mặc định (TP.HCM)

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    {% for pothole in potholes %}
        var marker = L.circleMarker([{{ pothole.latitude }}, {{ pothole.longitude }}], {
            color: {% if pothole.id == highlighted.id %} 'blue' {% elif pothole.detections_count > 3 %} 'red' {% else %} 'green' {% endif %},
            radius: {% if pothole.id == highlighted.id %} 10 {% elif pothole.confidence_avg > 0.7 %} 8 {% else %} 5 {% endif %}
        }).addTo(map);

        marker.bindPopup("Ổ gà ID: {{ pothole.id }}<br>Phát hiện: {{ pothole.detections_count }} lần <br> Độ tin cậy TB: {{ pothole.confidence_avg|floatformat:2 }}%");
    {% endfor %}

    {% if highlighted %}
        map.setView([{{ highlighted.latitude }}, {{ highlighted.longitude }}], 16);
    {% endif %}
</script>
  </body>
</html>
